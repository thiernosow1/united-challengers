{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/together/together/client/src/components/home.js\";\nimport React, { Component } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport \"../assets/css/app.css\";\nimport StyledFirebaseAuth from \"react-firebaseui/StyledFirebaseAuth\";\nimport firebase from \"firebase\";\nimport firebaseConfig from \"../firebase/config\";\nimport { db, auth, storage } from \"../firebase/config\";\nimport Post from \"./post\";\nexport default class Home extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isSignedIn: true,\n      posts: []\n    };\n\n    this.handleDislike = e => {\n      e.preventDefault();\n      const postId = e.target.id;\n      const userId = localStorage.getItem(\"userId\");\n      let newPosts = [...this.state.posts];\n      const idx = newPosts.findIndex(post => post.id == postId);\n      let newLikes = newPosts[idx].likes.filter(like => !like.isEqual(db.doc(`users/${userId}`)));\n      db.doc(`posts/${postId}`).update({\n        likes: newLikes\n      }).then(postRef => {\n        newPosts[idx].likes = newLikes;\n        this.setState({\n          posts: newPosts\n        }, () => console.log(this.state.posts));\n      });\n    };\n\n    this.handleLike = e => {\n      e.preventDefault();\n      const postId = e.target.id;\n      const userId = localStorage.getItem(\"userId\");\n      let newPosts = [...this.state.posts];\n      const idx = newPosts.findIndex(post => post.id == postId);\n      newPosts[idx].likes.push(db.doc(`users/${userId}`));\n      db.doc(`posts/${postId}`).update({\n        likes: newPosts[idx].likes\n      }).then(postRef => {\n        this.setState({\n          posts: newPosts\n        }, () => console.log(this.state.posts));\n      });\n    };\n  }\n\n  componentDidMount() {\n    db.collection(\"posts\").get().then(snapshot => {\n      let posts = [];\n      snapshot.docs.forEach(doc => {\n        let post = doc.data();\n        post.id = doc.ref.id;\n        console.log(post.author);\n\n        if (post.author && post.challenge_ref) {\n          db.doc(post.author.path).get().then(res => {\n            post.author = res.data();\n            post.author.id = res.ref.id;\n            db.doc(post.challenge_ref.path).get().then(res => {\n              post.challenge_ref = res.data();\n              post.challenge_ref.id = res.id;\n            });\n          }).catch(error => console.log(error));\n          posts.push(post);\n        }\n      });\n      this.setState({\n        posts\n      });\n    }).catch(error => console.log(error));\n  } // Fonctionnalité like\n\n\n  isLiked(post) {\n    const userId = localStorage.getItem(\"userId\");\n    const elmt = post.likes.findIndex(like => like.isEqual(db.doc(`users/${userId}`)));\n    console.log(elmt);\n    return elmt !== -1;\n  }\n\n  // Affichage Post\n  displayPosts(posts) {\n    return posts.map(post => /*#__PURE__*/React.createElement(\"div\", {\n      className: \"displayPosts\",\n      key: post.id,\n      class: \"post\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"infos\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      alt: \"profil picture\",\n      src: \"/logout/avatar.svg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"h4\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 21\n      }\n    }, post.author), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 21\n      }\n    }, new Date(post.created_at).toLocaleDateString()))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"container_img_home\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: \"imageForm\",\n      src: post.picture_url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 21\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"likes\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }\n    }, this.isLiked(post) ? /*#__PURE__*/React.createElement(\"img\", {\n      id: post.id,\n      className: \"imgLike\",\n      src: \"/heart_full.svg\",\n      onClick: this.handleDislike,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 13\n      }\n    }) : /*#__PURE__*/React.createElement(\"img\", {\n      id: post.id,\n      className: \"imgLike\",\n      src: \"/heart.svg\",\n      onClick: this.handleLike,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 11\n      }\n    }, post.likes.length))));\n  }\n\n  render() {\n    const {\n      posts\n    } = this.state;\n    console.log(posts);\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"home\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/profil\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 11\n      }\n    }, \" \", /*#__PURE__*/React.createElement(\"img\", {\n      alt: \"profil picture\",\n      className: \"avatar\",\n      src: \"/logout/avatar.svg\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 13\n      }\n    }), \" \"), /*#__PURE__*/React.createElement(Link, {\n      to: \"/login\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => firebase.auth().signOut(),\n      className: \"logout\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"en-tete\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 11\n      }\n    }, \"D\\xE9couvrir\")), posts.length == 0 ? /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 11\n      }\n    }, \" Aucune publication \") : /*#__PURE__*/React.createElement(\"div\", {\n      class: \"publications_on_home\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 13\n      }\n    }, this.displayPosts(posts)), /*#__PURE__*/React.createElement(\"nav\", {\n      className: \"nav_menu\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/home\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"img1_b\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Link, {\n      to: \"/post\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"img2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Link, {\n      to: \"/subscription\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"img3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Link, {\n      to: \"/defi\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"img4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }\n    }))));\n  }\n\n}","map":{"version":3,"sources":["/Applications/MAMP/htdocs/together/together/client/src/components/home.js"],"names":["React","Component","Link","StyledFirebaseAuth","firebase","firebaseConfig","db","auth","storage","Post","Home","state","isSignedIn","posts","handleDislike","e","preventDefault","postId","target","id","userId","localStorage","getItem","newPosts","idx","findIndex","post","newLikes","likes","filter","like","isEqual","doc","update","then","postRef","setState","console","log","handleLike","push","componentDidMount","collection","get","snapshot","docs","forEach","data","ref","author","challenge_ref","path","res","catch","error","isLiked","elmt","displayPosts","map","Date","created_at","toLocaleDateString","picture_url","length","render","signOut"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport \"../assets/css/app.css\";\nimport StyledFirebaseAuth from \"react-firebaseui/StyledFirebaseAuth\";\nimport firebase from \"firebase\";\nimport firebaseConfig from \"../firebase/config\";\nimport { db, auth, storage } from \"../firebase/config\";\nimport Post from \"./post\";\n\nexport default class Home extends Component {\n  state = {\n    isSignedIn: true,\n    posts: [],\n  };\n\n  componentDidMount() {\n    db.collection(\"posts\")\n      .get()\n      .then((snapshot) => {\n        let posts = [];\n        snapshot.docs.forEach((doc) => {\n          let post = doc.data();\n          post.id = doc.ref.id;\n          console.log(post.author);\n          if (post.author && post.challenge_ref) {\n            db.doc(post.author.path)\n              .get()\n              .then((res) => {\n                post.author = res.data();\n                post.author.id = res.ref.id;\n                db.doc(post.challenge_ref.path)\n                  .get()\n                  .then((res) => {\n                    post.challenge_ref = res.data();\n                    post.challenge_ref.id = res.id;\n                  });\n              })\n              .catch((error) => console.log(error));\n            posts.push(post);\n          }\n        });\n        this.setState({ posts });\n      })\n      .catch((error) => console.log(error));\n  }\n\n  // Fonctionnalité like\n  isLiked(post) {\n    const userId = localStorage.getItem(\"userId\");\n    const elmt = post.likes.findIndex((like) =>\n      like.isEqual(db.doc(`users/${userId}`))\n    );\n    console.log(elmt);\n    return elmt !== -1;\n  }\n\n  handleDislike = (e) => {\n    e.preventDefault();\n    const postId = e.target.id;\n    const userId = localStorage.getItem(\"userId\");\n    let newPosts = [...this.state.posts];\n    const idx = newPosts.findIndex((post) => post.id == postId);\n    let newLikes = newPosts[idx].likes.filter(\n      (like) => !like.isEqual(db.doc(`users/${userId}`))\n    );\n    db.doc(`posts/${postId}`)\n      .update({\n        likes: newLikes,\n      })\n      .then((postRef) => {\n        newPosts[idx].likes = newLikes;\n        this.setState({ posts: newPosts }, () => console.log(this.state.posts));\n      });\n  };\n\n  handleLike = (e) => {\n    e.preventDefault();\n    const postId = e.target.id;\n    const userId = localStorage.getItem(\"userId\");\n    let newPosts = [...this.state.posts];\n    const idx = newPosts.findIndex((post) => post.id == postId);\n    newPosts[idx].likes.push(db.doc(`users/${userId}`));\n    db.doc(`posts/${postId}`)\n      .update({\n        likes: newPosts[idx].likes,\n      })\n      .then((postRef) => {\n        this.setState({ posts: newPosts }, () => console.log(this.state.posts));\n      });\n  };\n\n  // Affichage Post\n  displayPosts(posts) {\n    return posts.map((post) => (\n      <div className=\"displayPosts\" key={post.id} class=\"post\">\n \n                <div className=\"infos\">\n                    <div>\n                <img\n                    alt=\"profil picture\"\n                    src=\"/logout/avatar.svg\"\n                />\n                </div>\n                \n                    {/* <h4>{post.author.login} </h4>\n                    */}\n                    <div>\n                    <h4>{post.author}</h4>\n                    <p>{new Date(post.created_at).toLocaleDateString()}</p>\n                    </div>\n                </div>\n   \n                    <div className=\"container_img_home\">\n                    <img className=\"imageForm\" src={post.picture_url} />\n                    </div>\n        <div className=\"likes\">\n          {this.isLiked(post) ? (\n            <img\n              id={post.id}\n              className=\"imgLike\"\n              src=\"/heart_full.svg\"\n              onClick={this.handleDislike}\n            />\n          ) : (\n            <img\n              id={post.id}\n              className=\"imgLike\"\n              src=\"/heart.svg\"\n              onClick={this.handleLike}\n            />\n          )}\n          <p>{post.likes.length}</p>\n        </div>\n       \n        {/* <p>{post.challenge_ref.duration} </p> \n        <div> {post.challenge_ref.description} </div>*/}\n      </div>\n\n    ));\n  }\n\n  render() {\n    const { posts } = this.state;\n    console.log(posts);\n    return (\n      <div className=\"home\">\n        <div className=\"header\">\n          <Link to=\"/profil\">\n            {\" \"}\n            <img\n              alt=\"profil picture\"\n              className=\"avatar\"\n              src=\"/logout/avatar.svg\"\n            />{\" \"}\n          </Link>\n          <Link to=\"/login\">\n            <button\n              onClick={() => firebase.auth().signOut()}\n              className=\"logout\"\n            ></button>\n          </Link>\n        </div>\n\n        <div className=\"en-tete\">\n          <h2>Découvrir</h2>\n        </div>\n\n        {posts.length == 0 ? (\n          <p> Aucune publication </p>\n        ) : (\n            <div class=\"publications_on_home\">\n          {this.displayPosts(posts)}\n          </div>\n        )}\n\n        <nav className=\"nav_menu\">\n          <Link to=\"/home\">\n            <div className=\"img1_b\"></div>\n          </Link>\n          <Link to=\"/post\">\n            <div className=\"img2\"></div>\n          </Link>\n          <Link to=\"/subscription\">\n            <div className=\"img3\"></div>\n          </Link>\n          <Link to=\"/defi\">\n            <div className=\"img4\"></div>\n          </Link>\n        </nav>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}